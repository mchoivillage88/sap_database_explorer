import{o as R,j as t,p as P,B as C}from"./index-zm6__J2_.js";function B({table:d,relatedTables:u,allTables:W,onSelectTable:N}){const I=R(),g=400,m=250,p=210,b=180,M=80,j=160,w=70,v=s=>{switch(s){case"one-to-one":return"#10b981";case"one-to-many":return"#3b82f6";case"many-to-one":return"#3b82f6";case"many-to-many":return"#a855f7"}},f=(s,x,e,n)=>{const c=e+Math.PI/2,l=s+Math.cos(c)*10,i=x+Math.sin(c)*10,r=s-Math.cos(c)*10,a=x-Math.sin(c)*10;return t.jsx("line",{x1:l,y1:i,x2:r,y2:a,stroke:n,strokeWidth:"2"})},k=(s,x,e,n)=>{const l=s-Math.cos(e+.5)*10,i=x-Math.sin(e+.5)*10,r=s-Math.cos(e-.5)*10,a=x-Math.sin(e-.5)*10;return t.jsxs("g",{children:[t.jsx("line",{x1:s,y1:x,x2:l,y2:i,stroke:n,strokeWidth:"2"}),t.jsx("line",{x1:s,y1:x,x2:r,y2:a,stroke:n,strokeWidth:"2"})]})},L=s=>W.find(e=>e.name===s)?.description||"",A=(s,x,e,n,o)=>{const c=Math.cos(e),l=Math.sin(e),i=n/2,r=o/2,a=Math.tan(e);let h,y;return Math.abs(c)>Math.abs(l)?(h=c>0?i:-i,y=h*a,Math.abs(y)>r&&(y=l>0?r:-r,h=y/a)):(y=l>0?r:-r,h=y/a,Math.abs(h)>i&&(h=c>0?i:-i,y=h*a)),{x:s+h,y:x+y}};return t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h3",{className:"mb-4",children:"Entity Relationship Diagram"}),u.length===0?t.jsx("div",{className:"text-center text-gray-500 py-8",children:"No relationships defined for this table"}):t.jsxs("svg",{viewBox:"0 0 800 500",className:"mx-auto w-full h-auto",style:{maxWidth:"100%",minHeight:I?"500px":"300px",transform:I?"scale(1.4)":"scale(1)",transformOrigin:"center top"},children:[d.relationships.map((s,x)=>{const e=x*2*Math.PI/d.relationships.length-Math.PI/2,n=v(s.type),o=A(g,m,e,b,M),c=g+Math.cos(e)*p,l=m+Math.sin(e)*p,i=A(c,l,e+Math.PI,j,w),r=8,a={x:o.x+Math.cos(e)*r,y:o.y+Math.sin(e)*r},h={x:i.x-Math.cos(e)*r,y:i.y-Math.sin(e)*r};return t.jsxs("g",{children:[t.jsx("line",{x1:o.x,y1:o.y,x2:i.x,y2:i.y,stroke:n,strokeWidth:"2"}),s.type==="one-to-one"&&t.jsxs(t.Fragment,{children:[f(o.x,o.y,e,n),f(i.x,i.y,e+Math.PI,n)]}),s.type==="one-to-many"&&t.jsxs(t.Fragment,{children:[f(o.x,o.y,e,n),k(h.x,h.y,e+Math.PI,n)]}),s.type==="many-to-one"&&t.jsxs(t.Fragment,{children:[k(a.x,a.y,e,n),f(i.x,i.y,e+Math.PI,n)]}),s.type==="many-to-many"&&t.jsxs(t.Fragment,{children:[k(a.x,a.y,e,n),k(h.x,h.y,e+Math.PI,n)]})]},`${s.targetTable}-${x}`)}),t.jsxs("g",{style:{cursor:"pointer"},onClick:()=>N(d.name),children:[t.jsx("rect",{x:g-b/2,y:m-M/2,width:b,height:M,fill:"#1e40af",stroke:"#1e3a8a",strokeWidth:"2",rx:"6"}),t.jsx("text",{x:g,y:m-20,textAnchor:"middle",className:"text-sm",fill:"white",children:d.name}),t.jsx("text",{x:g,y:m-4,textAnchor:"middle",className:"text-xs",fill:"#bfdbfe",children:d.description}),d.typicalRecordCount&&(()=>{const s=P(d.typicalRecordCount);return t.jsx(t.Fragment,{children:t.jsx("foreignObject",{x:g-60,y:m+8,width:"120",height:"20",children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[t.jsx(C,{className:`${s.color} text-white text-xs`,style:{fontSize:"9px",height:"14px",lineHeight:"14px",display:"inline-block",padding:"0 3px"},children:s.label}),t.jsxs("span",{style:{fontSize:"12px",color:"#93c5fd",whiteSpace:"nowrap"},children:[d.typicalRecordCount," records"]})]})})})})()]}),d.relationships.map((s,x)=>{const e=x*2*Math.PI/d.relationships.length-Math.PI/2,n=g+Math.cos(e)*p,o=m+Math.sin(e)*p,c=v(s.type),l=L(s.targetTable),r=W.find(h=>h.name===s.targetTable)?.typicalRecordCount||"",a=r?P(r):null;return t.jsxs("g",{style:{cursor:"pointer"},onClick:()=>N(s.targetTable),children:[t.jsx("rect",{x:n-j/2,y:o-w/2,width:j,height:w,fill:c,fillOpacity:"0.1",stroke:c,strokeWidth:"2",rx:"6"}),t.jsx("text",{x:n,y:o-18,textAnchor:"middle",className:"text-sm",fill:c,children:s.targetTable}),t.jsx("text",{x:n,y:o-2,textAnchor:"middle",className:"text-xs",fill:"gray",style:{maxWidth:`${j-10}px`},children:l.length>20?l.substring(0,20)+"...":l}),a&&r&&t.jsx(t.Fragment,{children:t.jsx("foreignObject",{x:n-55,y:o+8,width:"110",height:"20",children:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"3px"},children:[t.jsx(C,{className:`${a.color} text-white text-xs`,style:{fontSize:"8px",height:"12px",lineHeight:"12px",display:"inline-block",padding:"0 3px"},children:a.label}),t.jsxs("span",{style:{fontSize:"12px",color:"#6b7280",whiteSpace:"nowrap"},children:[r," records"]})]})})})]},`box-${s.targetTable}-${x}`)})]}),u.length>0&&t.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[t.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"Relationship Notation:"}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("svg",{width:"60",height:"30",children:[t.jsx("line",{x1:"10",y1:"15",x2:"50",y2:"15",stroke:"#10b981",strokeWidth:"2"}),t.jsx("line",{x1:"10",y1:"10",x2:"10",y2:"20",stroke:"#10b981",strokeWidth:"2"}),t.jsx("line",{x1:"50",y1:"10",x2:"50",y2:"20",stroke:"#10b981",strokeWidth:"2"})]}),t.jsx("span",{className:"text-sm text-gray-600",children:"One-to-One"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("svg",{width:"60",height:"30",children:[t.jsx("line",{x1:"10",y1:"15",x2:"50",y2:"15",stroke:"#3b82f6",strokeWidth:"2"}),t.jsx("line",{x1:"10",y1:"10",x2:"10",y2:"20",stroke:"#3b82f6",strokeWidth:"2"}),t.jsx("line",{x1:"50",y1:"15",x2:"44",y2:"10",stroke:"#3b82f6",strokeWidth:"2"}),t.jsx("line",{x1:"50",y1:"15",x2:"44",y2:"20",stroke:"#3b82f6",strokeWidth:"2"})]}),t.jsx("span",{className:"text-sm text-gray-600",children:"One-to-Many"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("svg",{width:"60",height:"30",children:[t.jsx("line",{x1:"10",y1:"15",x2:"50",y2:"15",stroke:"#3b82f6",strokeWidth:"2"}),t.jsx("line",{x1:"10",y1:"15",x2:"16",y2:"10",stroke:"#3b82f6",strokeWidth:"2"}),t.jsx("line",{x1:"10",y1:"15",x2:"16",y2:"20",stroke:"#3b82f6",strokeWidth:"2"}),t.jsx("line",{x1:"50",y1:"10",x2:"50",y2:"20",stroke:"#3b82f6",strokeWidth:"2"})]}),t.jsx("span",{className:"text-sm text-gray-600",children:"Many-to-One"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("svg",{width:"60",height:"30",children:[t.jsx("line",{x1:"10",y1:"15",x2:"50",y2:"15",stroke:"#a855f7",strokeWidth:"2"}),t.jsx("line",{x1:"10",y1:"15",x2:"16",y2:"10",stroke:"#a855f7",strokeWidth:"2"}),t.jsx("line",{x1:"10",y1:"15",x2:"16",y2:"20",stroke:"#a855f7",strokeWidth:"2"}),t.jsx("line",{x1:"50",y1:"15",x2:"44",y2:"10",stroke:"#a855f7",strokeWidth:"2"}),t.jsx("line",{x1:"50",y1:"15",x2:"44",y2:"20",stroke:"#a855f7",strokeWidth:"2"})]}),t.jsx("span",{className:"text-sm text-gray-600",children:"Many-to-Many"})]})]})]})]})}export{B as ERDiagram};
